<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Plan Subscription Model | Laravel Subby</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Laravel Subby is a flexible plans and subscription management system for Laravel.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/laravel-subby/assets/css/0.styles.34a846c2.css" as="style"><link rel="preload" href="/laravel-subby/assets/js/app.e3f2709f.js" as="script"><link rel="preload" href="/laravel-subby/assets/js/2.a567fcab.js" as="script"><link rel="preload" href="/laravel-subby/assets/js/35.a4ac7256.js" as="script"><link rel="preload" href="/laravel-subby/assets/js/3.c3b3b9d1.js" as="script"><link rel="prefetch" href="/laravel-subby/assets/js/10.c8cfcafb.js"><link rel="prefetch" href="/laravel-subby/assets/js/11.07bdaa73.js"><link rel="prefetch" href="/laravel-subby/assets/js/12.e16dd0d1.js"><link rel="prefetch" href="/laravel-subby/assets/js/13.cf177ca2.js"><link rel="prefetch" href="/laravel-subby/assets/js/14.397cada5.js"><link rel="prefetch" href="/laravel-subby/assets/js/15.288127e5.js"><link rel="prefetch" href="/laravel-subby/assets/js/16.f4a730af.js"><link rel="prefetch" href="/laravel-subby/assets/js/17.65399f49.js"><link rel="prefetch" href="/laravel-subby/assets/js/18.dc8388f4.js"><link rel="prefetch" href="/laravel-subby/assets/js/19.0a6df4cc.js"><link rel="prefetch" href="/laravel-subby/assets/js/20.6e97dc5c.js"><link rel="prefetch" href="/laravel-subby/assets/js/21.2accc103.js"><link rel="prefetch" href="/laravel-subby/assets/js/22.0a1d1f10.js"><link rel="prefetch" href="/laravel-subby/assets/js/23.a1e48c29.js"><link rel="prefetch" href="/laravel-subby/assets/js/24.89c99a3f.js"><link rel="prefetch" href="/laravel-subby/assets/js/25.e5c61270.js"><link rel="prefetch" href="/laravel-subby/assets/js/26.a531ca49.js"><link rel="prefetch" href="/laravel-subby/assets/js/27.cd86e778.js"><link rel="prefetch" href="/laravel-subby/assets/js/28.e138526c.js"><link rel="prefetch" href="/laravel-subby/assets/js/29.e9503321.js"><link rel="prefetch" href="/laravel-subby/assets/js/30.2169c31e.js"><link rel="prefetch" href="/laravel-subby/assets/js/31.36208325.js"><link rel="prefetch" href="/laravel-subby/assets/js/32.8487002d.js"><link rel="prefetch" href="/laravel-subby/assets/js/33.dc32bfab.js"><link rel="prefetch" href="/laravel-subby/assets/js/34.4c8f0bf0.js"><link rel="prefetch" href="/laravel-subby/assets/js/36.03bb72c1.js"><link rel="prefetch" href="/laravel-subby/assets/js/37.518106e2.js"><link rel="prefetch" href="/laravel-subby/assets/js/38.e156ac3f.js"><link rel="prefetch" href="/laravel-subby/assets/js/39.a49e6560.js"><link rel="prefetch" href="/laravel-subby/assets/js/4.acbb960e.js"><link rel="prefetch" href="/laravel-subby/assets/js/40.e3219892.js"><link rel="prefetch" href="/laravel-subby/assets/js/41.53b52fb4.js"><link rel="prefetch" href="/laravel-subby/assets/js/42.7d8df0bf.js"><link rel="prefetch" href="/laravel-subby/assets/js/43.3c2c8db2.js"><link rel="prefetch" href="/laravel-subby/assets/js/44.3cd99be9.js"><link rel="prefetch" href="/laravel-subby/assets/js/45.0c6427c6.js"><link rel="prefetch" href="/laravel-subby/assets/js/46.6a2a2939.js"><link rel="prefetch" href="/laravel-subby/assets/js/47.59666485.js"><link rel="prefetch" href="/laravel-subby/assets/js/48.eb0156e6.js"><link rel="prefetch" href="/laravel-subby/assets/js/49.c5f5ddf6.js"><link rel="prefetch" href="/laravel-subby/assets/js/5.95232046.js"><link rel="prefetch" href="/laravel-subby/assets/js/50.d39d80e3.js"><link rel="prefetch" href="/laravel-subby/assets/js/51.16ccb1a1.js"><link rel="prefetch" href="/laravel-subby/assets/js/52.9eba4ba7.js"><link rel="prefetch" href="/laravel-subby/assets/js/53.d3c6f216.js"><link rel="prefetch" href="/laravel-subby/assets/js/54.48ca7513.js"><link rel="prefetch" href="/laravel-subby/assets/js/55.3dde4c88.js"><link rel="prefetch" href="/laravel-subby/assets/js/56.a141c51e.js"><link rel="prefetch" href="/laravel-subby/assets/js/57.e5ef4fb2.js"><link rel="prefetch" href="/laravel-subby/assets/js/58.46a55deb.js"><link rel="prefetch" href="/laravel-subby/assets/js/59.28f84351.js"><link rel="prefetch" href="/laravel-subby/assets/js/6.7d37a87a.js"><link rel="prefetch" href="/laravel-subby/assets/js/60.f002fe89.js"><link rel="prefetch" href="/laravel-subby/assets/js/61.0e8ba76f.js"><link rel="prefetch" href="/laravel-subby/assets/js/62.6d8de3a7.js"><link rel="prefetch" href="/laravel-subby/assets/js/63.83de6435.js"><link rel="prefetch" href="/laravel-subby/assets/js/64.2fbe335c.js"><link rel="prefetch" href="/laravel-subby/assets/js/7.6a250539.js"><link rel="prefetch" href="/laravel-subby/assets/js/8.c1c8c4b1.js"><link rel="prefetch" href="/laravel-subby/assets/js/9.4274a4a5.js">
    <link rel="stylesheet" href="/laravel-subby/assets/css/0.styles.34a846c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/laravel-subby/" class="home-link router-link-active"><!----> <span class="site-name">Laravel Subby</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/laravel-subby/" class="nav-link">
  Home
</a></div> <a href="https://github.com/bpuig/laravel-subby" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/laravel-subby/" class="nav-link">
  Home
</a></div> <a href="https://github.com/bpuig/laravel-subby" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>The package</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/laravel-subby/v5.x/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/laravel-subby/v5.x/install/" class="sidebar-link">Installation</a></li><li><a href="/laravel-subby/v5.x/install/migrate-v5.html" class="sidebar-link">Upgrade v4 to v5</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Usage</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/laravel-subby/v5.x/models/" aria-current="page" class="sidebar-link">Models</a></li><li><a href="/laravel-subby/v5.x/models/plan-model.html" class="sidebar-link">Plan Model</a></li><li><a href="/laravel-subby/v5.x/models/plan-feature-model.html" class="sidebar-link">Plan Feature Model</a></li><li><a href="/laravel-subby/v5.x/models/plan-subscription-model.html" aria-current="page" class="active sidebar-link">Plan Subscription Model</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#create-a-subscription" class="sidebar-link">Create a Subscription</a></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#change-its-plan" class="sidebar-link">Change its Plan</a></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#change-pricing-and-other-details" class="sidebar-link">Change pricing and other details</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#revert-custom-subscription-changes-resynchronize-to-plan" class="sidebar-link">Revert custom subscription changes (resynchronize to plan)</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#grace" class="sidebar-link">Grace</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#grace-related-functions" class="sidebar-link">Grace related functions</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#subscriber-s-subscriptions" class="sidebar-link">Subscriber's subscriptions</a></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#subscriber-s-main-or-only-subscription" class="sidebar-link">Subscriber's main or only subscription</a></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#subscription-feature-usage" class="sidebar-link">Subscription Feature Usage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#record-feature-usage" class="sidebar-link">Record Feature Usage</a></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#reduce-feature-usage" class="sidebar-link">Reduce Feature Usage</a></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#clear-the-subscription-usage-data" class="sidebar-link">Clear the Subscription Usage data</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#check-subscription-status" class="sidebar-link">Check Subscription status</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#remaining-price-prorate" class="sidebar-link">Remaining price prorate</a></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#trial-period-time-related-functions" class="sidebar-link">Trial period time related functions</a></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#subscription-period-time-related-functions" class="sidebar-link">Subscription period time related functions</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#revert-overridden-plan-subscription-features" class="sidebar-link">Revert overridden plan subscription features</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#other" class="sidebar-link">Other</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#renew-a-subscription" class="sidebar-link">Renew a Subscription</a></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#cancel-a-subscription" class="sidebar-link">Cancel a Subscription</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#immediately" class="sidebar-link">Immediately</a></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#fallback-plan" class="sidebar-link">Fallback plan</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#uncancel-a-subscription" class="sidebar-link">Uncancel a subscription</a></li><li class="sidebar-sub-header"><a href="/laravel-subby/v5.x/models/plan-subscription-model.html#scopes" class="sidebar-link">Scopes</a></li></ul></li><li><a href="/laravel-subby/v5.x/models/plan-subscription-feature-model.html" class="sidebar-link">Plan Subscription Feature Model</a></li><li><a href="/laravel-subby/v5.x/models/plan-subscription-schedule-model.html" class="sidebar-link">Plan Subscription Schedule Model</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="plan-subscription-model"><a href="#plan-subscription-model" class="header-anchor">#</a> Plan Subscription Model</h1> <h2 id="create-a-subscription"><a href="#create-a-subscription" class="header-anchor">#</a> Create a Subscription</h2> <p>You can subscribe a user (or any model correctly traited) to a plan by using the <code>newSubscription()</code> function available
in the <code>HasSubscriptions</code> trait. First, retrieve an instance of your subscriber's model, which typically will be your
user model and an instance of the plan your subscriber is subscribing to. Once you have retrieved the model instance,
you may use the <code>newSubscription</code> method to create the model's subscription.</p> <p>The subscription is made as a <em>snapshot</em> using current plan details as a template. Same happens with subscription
features. When you create a subscription a copy of the Plan Features is made into your Plan Subscription Features.</p> <p>If related plan is modified in the future, subscriber's subscription stays as it was, price, invoicing and features
are &quot;frozen&quot; unless
<a href="/laravel-subby/v5.x/models/plan-subscription-model.html#revert-overridden-plan-subscription-features">manually synchronized</a> with related plan.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$plan</span> <span class="token operator">=</span> <span class="token class-name static-context">Plan</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">newSubscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">,</span> <span class="token variable">$plan</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Main subscription'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Customer main subscription'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>First argument passed to <code>newSubscription</code> method should be the identifier tag of the subscription. If your
application offers a single subscription, you might call this <code>main</code> or <code>primary</code>.</li> <li>Second argument is the plan instance your subscriber is subscribing to.</li> <li>Third argument is a human-readable name for your subscription.</li> <li>Fourth argument is a description.</li> <li>Fifth argument is a start date for the subscription.</li></ul> <h2 id="change-its-plan"><a href="#change-its-plan" class="header-anchor">#</a> Change its Plan</h2> <p>You can change subscription related plan easily as follows:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$plan</span> <span class="token operator">=</span> <span class="token class-name static-context">Plan</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$subscription</span> <span class="token operator">=</span> <span class="token class-name static-context">PlanSubscription</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Change subscription plan clearing usage and synchronizing invoicing periods</span>
<span class="token variable">$subscription</span><span class="token operator">-&gt;</span><span class="token function">changePlan</span><span class="token punctuation">(</span><span class="token variable">$plan</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Change subscription plan and keep usage</span>
<span class="token variable">$subscription</span><span class="token operator">-&gt;</span><span class="token function">changePlan</span><span class="token punctuation">(</span><span class="token variable">$plan</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Change subscription plan, keep usage and invoicing data</span>
<span class="token variable">$subscription</span><span class="token operator">-&gt;</span><span class="token function">changePlan</span><span class="token punctuation">(</span><span class="token variable">$plan</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Subscription usage data will be cleared by default, unless <code>false</code> is given as second parameter.</p> <p>If you want the same billing frequency (<code>invoice_period</code> and <code>invoice_interval</code>) set third parameter to <code>true</code>
and subscription will inherit plan's billing frequency. If you want to keep current subscription invoice intervals, set
to <code>false</code>. By default, invoice details are synchronized with new plan.</p> <ul><li>Plan change will adjust existing features to the ones in the new plan.</li> <li>Change will also remove features attached to old plan.</li> <li>Existent features that where previously attached without plan but exist in the new plan now will use plan values.</li> <li>Features not attached to a plan and nonexistent in new plan will remain the same.</li></ul> <h2 id="change-pricing-and-other-details"><a href="#change-pricing-and-other-details" class="header-anchor">#</a> Change pricing and other details</h2> <p>You can change the price or details without affecting attached features or plan. With this feature you can set prices
individually for every subscriber.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$subscription</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$subscription</span><span class="token operator">-&gt;</span><span class="token property">description</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Main description with great discount'</span><span class="token punctuation">;</span>
<span class="token variable">$subscription</span><span class="token operator">-&gt;</span><span class="token property">price</span> <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>

<span class="token variable">$subscription</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="revert-custom-subscription-changes-resynchronize-to-plan"><a href="#revert-custom-subscription-changes-resynchronize-to-plan" class="header-anchor">#</a> Revert custom subscription changes (resynchronize to plan)</h3> <p>You can revert changes made to subscription with function <code>syncPlan</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Synchronize price, invoicing and tier with related plan</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">syncPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Synchronize plan and also features</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">syncPlan</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>syncPlan()</code> accepts 3 parameters. First parameter is a <code>Plan</code>, if you want to synchronize with current plan
(default behaviour), set to <code>null</code>. Second is <code>bool</code> for synchronizing also invoicing details (period and interval),
default behaviour is to synchronize <code>true</code>. The third one is <code>bool</code> to also synchronize features.</p> <h2 id="grace"><a href="#grace" class="header-anchor">#</a> Grace <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>new in v5.0</span></h2> <p>Grace period is the extra time the subscription will be considered active after it has ended.</p> <h3 id="grace-related-functions"><a href="#grace-related-functions" class="header-anchor">#</a> Grace related functions</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">hasGrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns boolean indicating if subscription has grace period</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getGraceTotalDurationIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns duration integer in set Carbon interval (second, day, month...)</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getGraceStartDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns grace start date (a.k.a. subscription end date)</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getGraceEndDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns grace end date</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getGraceTotalDurationIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns number of days grace lasts</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getGracePeriodUsageIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns number of days of grace consumed</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getGracePeriodRemainingUsageIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns number of days until subscription grace ends</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">hasStartedGrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns boolean indicating if grace period is over</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">hasEndedGrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns boolean indicating if grace period is over</span>
</code></pre></div><h2 id="subscriber-s-subscriptions"><a href="#subscriber-s-subscriptions" class="header-anchor">#</a> Subscriber's subscriptions</h2> <p>Retrieve subscriptions of subscriber.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Get user subscriptions</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">subscriptions</span><span class="token punctuation">;</span>

<span class="token comment">// Get user active subscriptions</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">activeSubscriptions</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="subscriber-s-main-or-only-subscription"><a href="#subscriber-s-main-or-only-subscription" class="header-anchor">#</a> Subscriber's main or only subscription</h2> <p>Since usually projects work with only one subscription or one primary, you have to set the tag for it in the
config <code>main_subscription_tag</code>.</p> <p>If your user only has one subscription, <code>subscription()</code> will return the only one the subscriber has. If has more, it
will fall to default. Default is <code>main</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// config/subby.php</span>
<span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'main_subscription_tag'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'main'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>Then:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// This retrieves user's only one subscription or 'main' from config:</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="subscription-feature-usage"><a href="#subscription-feature-usage" class="header-anchor">#</a> Subscription Feature Usage</h2> <p>You can determine the usage and ability of a particular feature in the subscriber's subscription with <code>canUseFeature</code>:</p> <p>The <code>canUseFeature</code> method returns <code>true</code> or <code>false</code> depending on multiple factors:</p> <ul><li>Subscription is active (on trial or currently in period).</li> <li>Feature <em>is enabled</em> (<code>true</code>).</li> <li>Feature value isn't <code>0</code>/<code>false</code>/<code>NULL</code>.</li> <li>Feature has remaining uses available.</li></ul> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">canUseFeature</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'social_profiles'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Other feature methods on the user subscription instance are:</p> <ul><li><code>getFeatureUsage</code>: returns how many times the user has used a particular feature.</li> <li><code>getFeatureRemainings</code>: returns available uses for a particular feature.</li> <li><code>getFeatureValue</code>: returns the feature value.</li></ul> <p>All methods share the same signature: e.g. <code>$user-&gt;subscription('main')-&gt;getFeatureUsage('social_profiles');</code>.</p> <h3 id="record-feature-usage"><a href="#record-feature-usage" class="header-anchor">#</a> Record Feature Usage <span class="badge warning" style="vertical-align:top;" data-v-15b7b770>updated in v5.0</span></h3> <div class="custom-block tip"><p class="custom-block-title">New in 5.0</p> <p>Check if subscriber can use feature before recording use</p></div> <p>In order to effectively use the ability methods you will need to keep track of every usage of each feature (or at least
those that require it). You may use the <code>recordFeatureUsage</code> method available through the user <code>subscription()</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">recordFeatureUsage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'social_profiles'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When recording feature <code>canUseFeature</code> is already called within the function, so you do not have to check every time.
<code>UsageDenied</code> Exception is thrown if subscriber cannot use the feature.</p> <p>The <code>recordFeatureUsage</code> method accepts 3 parameters: the first one is the feature's tag, the second one is the quantity
of uses to add (default is <code>1</code>), and the third one indicates if the addition should be incremental (default behavior),
when disabled the usage will be overridden by the quantity provided.</p> <details class="custom-block details"><summary>Click me to view example code</summary> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Increment by 1</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">recordFeatureUsage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'social_profiles'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Override with 3</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">recordFeatureUsage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'social_profiles'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></details> <h3 id="reduce-feature-usage"><a href="#reduce-feature-usage" class="header-anchor">#</a> Reduce Feature Usage</h3> <p>Reducing the feature usage is <em>almost</em> the same as incrementing it. Here we only <em>substract</em> a given quantity (default
is <code>1</code>) to the actual usage:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">reduceFeatureUsage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'social_profiles'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="clear-the-subscription-usage-data"><a href="#clear-the-subscription-usage-data" class="header-anchor">#</a> Clear the Subscription Usage data</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="check-subscription-status"><a href="#check-subscription-status" class="header-anchor">#</a> Check Subscription status</h2> <p>For a subscription to be considered active one of the following must be <code>true</code>:</p> <ul><li>Subscription has an active trial.</li> <li>Subscription <code>ends_at</code> is in the future.</li></ul> <p>Alternatively you can use the following methods available in the subscription model:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">isCanceled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">hasEnded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">hasEndedTrial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">isOnTrial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// To know if subscription has the same values as related plan or has been changed</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">isAltered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="remaining-price-prorate"><a href="#remaining-price-prorate" class="header-anchor">#</a> Remaining price prorate <span class="badge warning" style="vertical-align:top;" data-v-15b7b770>updated in v5.0</span></h3> <div class="custom-block danger"><p class="custom-block-title">Breaking change in v5.0</p> <p>Renamed <code>getRemainingPriceProrate</code> to  <code>getSubscriptionRemainingUsagePriceProrate</code></p></div> <p>You can get what is the remaining prorated amount until subscription invoice period ends.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getSubscriptionRemainingUsagePriceProrate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ex: 10 day subscription of price 10.00, on day 6, returns 4</span>
</code></pre></div><h3 id="trial-period-time-related-functions"><a href="#trial-period-time-related-functions" class="header-anchor">#</a> Trial period time related functions <span class="badge warning" style="vertical-align:top;" data-v-15b7b770>updated in v5.0</span></h3> <div class="custom-block danger"><p class="custom-block-title">Breaking change in v5.0</p> <p>Renamed <code>getDaysUntilTrialEnds</code> to <code>getTrialPeriodRemainingUsageIn</code></p></div> <p>You can get some information about duration in your trial with:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getTrialStartDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// When did the trial start</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getTrialTotalDurationIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns number of days trial lasts</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getTrialPeriodUsageIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns number of days of trial consumed</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getTrialPeriodRemainingUsageIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns number of days until subscription trial ends</span>
</code></pre></div><p>You can use Carbon accepted intervals (in singular): <code>year</code>,<code>month</code>,<code>day</code>,<code>hour</code>,<code>minute</code>,<code>second</code>,<code>microsecond</code>...</p> <h3 id="subscription-period-time-related-functions"><a href="#subscription-period-time-related-functions" class="header-anchor">#</a> Subscription period time related functions <span class="badge warning" style="vertical-align:top;" data-v-15b7b770>updated in v5.0</span></h3> <div class="custom-block danger"><p class="custom-block-title">Breaking change in v5.0</p> <p>Renamed <code>getTotalDurationInDays</code> to <code>getSubscriptionTotalDurationIn</code> <code>getDaysUntilEnds</code> to <code>getSubscriptionPeriodRemainingUsageIn</code></p></div> <p>You can get some information about duration in your subscription with:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getSubscriptionTotalDurationIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns number of days subscription lasts</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getSubscriptionPeriodUsageIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns number of days of subscription consumed</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getSubscriptionPeriodRemainingUsageIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns number of days until subscription ends</span>
</code></pre></div><p>You can use Carbon accepted intervals (in singular): <code>year</code>,<code>month</code>,<code>day</code>,<code>hour</code>,<code>minute</code>,<code>second</code>,<code>microsecond</code>...</p> <h2 id="revert-overridden-plan-subscription-features"><a href="#revert-overridden-plan-subscription-features" class="header-anchor">#</a> Revert overridden plan subscription features</h2> <p>You can revert all feature changes made to subscription that are related to a plan.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Resynchronize features</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">syncPlanFeatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Now all plan features available in subscription's related plan will be reset in subscription feature. If your subscriber
has attached manually a feature that was not previously available in plan, but now is, your custom subscription feature
will be related to plan feature and will be overridden with plan's feature details in this synchronization.</p> <h3 id="other"><a href="#other" class="header-anchor">#</a> Other</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Check if subscription is free</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">isFree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Check subscriber to plan</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">isSubscribedTo</span><span class="token punctuation">(</span><span class="token variable">$planId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Canceled subscriptions with an active trial or <code>ends_at</code> in the future are considered active.</p> <h2 id="renew-a-subscription"><a href="#renew-a-subscription" class="header-anchor">#</a> Renew a Subscription <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>updated in v5.0</span></h2> <div class="custom-block tip"><p class="custom-block-title">New in 5.0</p> <p>Now you can multiply the times the period is renewed</p></div> <p>To renew a subscription you may use the <code>renew</code> method available in the subscription model. This will set a
new <code>ends_at</code> date based on the selected plan.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">renew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">renew</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// This will triple the periods. CAUTION: If your subscription is 2 'month', you'll get 6 'month'</span>
</code></pre></div><p>Canceled subscriptions can't be renewed. Renewing a subscription with trial period ends it.</p> <p>When a subscription has already ended time ago and now is renewed, period will be set as if subscription started today, but when
a subscription is still ongoing and renewed, start date is kept and end date is extended by the amount of periods specified.</p> <h2 id="cancel-a-subscription"><a href="#cancel-a-subscription" class="header-anchor">#</a> Cancel a Subscription</h2> <p>To cancel a subscription, simply use the <code>cancel</code> method on the user's subscription:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="immediately"><a href="#immediately" class="header-anchor">#</a> Immediately</h3> <p>By default the subscription will remain active until the end of the period, you may pass <code>true</code> to end the
subscription <em>immediately</em>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="fallback-plan"><a href="#fallback-plan" class="header-anchor">#</a> Fallback plan</h3> <div class="custom-block tip"><p class="custom-block-title">New in 5.0</p> <p>Now you can specify in config a fallback plan</p></div> <p>If a <code>fallback_plan_tag</code> is not <code>null</code> in config, when <code>cancel</code> is called, subscription will not be canceled but changed
to fallback plan.</p> <p>To cancel subscription and ignore fallback, a second parameter is available on <code>cancel</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="uncancel-a-subscription"><a href="#uncancel-a-subscription" class="header-anchor">#</a> Uncancel a subscription</h2> <p>To uncancel a subscription, simply use the <code>uncancel</code> method on the user's subscription:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">uncancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="scopes"><a href="#scopes" class="header-anchor">#</a> Scopes</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Get subscriptions by plan</span>
<span class="token variable">$subscriptions</span> <span class="token operator">=</span> <span class="token class-name static-context">PlanSubscription</span><span class="token operator">::</span><span class="token function">byPlanId</span><span class="token punctuation">(</span><span class="token variable">$planId</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get bookings of the given user</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$bookingsOfUser</span> <span class="token operator">=</span> <span class="token class-name static-context">PlanSubscription</span><span class="token operator">::</span><span class="token function">ofSubscriber</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// Get subscriptions with trial ending in 3 days</span>
<span class="token variable">$subscriptions</span> <span class="token operator">=</span> <span class="token class-name static-context">PlanSubscription</span><span class="token operator">::</span><span class="token function">findEndingTrial</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get subscriptions with ended trial</span>
<span class="token variable">$subscriptions</span> <span class="token operator">=</span> <span class="token class-name static-context">PlanSubscription</span><span class="token operator">::</span><span class="token function">findEndedTrial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get subscriptions with period ending in 3 days</span>
<span class="token variable">$subscriptions</span> <span class="token operator">=</span> <span class="token class-name static-context">PlanSubscription</span><span class="token operator">::</span><span class="token function">findEndingPeriod</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get subscriptions with ended period</span>
<span class="token variable">$subscriptions</span> <span class="token operator">=</span> <span class="token class-name static-context">PlanSubscription</span><span class="token operator">::</span><span class="token function">findEndedPeriod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get subscriptions with period ending in 3 days filtered by the subscription tag</span>
<span class="token variable">$subscriptions</span> <span class="token operator">=</span> <span class="token class-name static-context">PlanSubscription</span><span class="token operator">::</span><span class="token function">getByTag</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'company'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">findEndingPeriod</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/15/2021, 7:38:41 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/laravel-subby/v5.x/models/plan-feature-model.html" class="prev">
        Plan Feature Model
      </a></span> <span class="next"><a href="/laravel-subby/v5.x/models/plan-subscription-feature-model.html">
        Plan Subscription Feature Model
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/laravel-subby/assets/js/app.e3f2709f.js" defer></script><script src="/laravel-subby/assets/js/2.a567fcab.js" defer></script><script src="/laravel-subby/assets/js/35.a4ac7256.js" defer></script><script src="/laravel-subby/assets/js/3.c3b3b9d1.js" defer></script>
  </body>
</html>
